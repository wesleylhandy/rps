<!doctype html>
<html>
  <head>
    <title>Rock, Paper, Scissors - Shoot!</title>

    <script src="https://use.fontawesome.com/5f1f3cb4d3.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />

    <link href="https://fonts.googleapis.com/css?family=Bowlby+One+SC" rel="stylesheet">

    <style>
    
      body {
        background: url("images/old_map.png");
        font-family: 'Bowlby One SC', cursive;
      }

      .container {
        margin-top: 2em;
      }

      .h2 {
        text-shadow: 1px 1px 1px #fff, 
               3px 3px 5px red;
      }

      .rps-ico {
        text-shadow: 1px 1px 1px red;
      }

      hr {
        border: 0.125em solid black;
      }

      .jumbotron, .well {
        border: 2px solid red;
      }

      #winner {
        color: red;
      }

    </style>

  </head>

  <body>

  
    <div class="container">

      <div class="row">
        <div class="col-md-offset-1 col-md-8">

          <div class="jumbotron">
            <div class = "h2 text-center">Let's play Rock, Paper, Scissors</div>
            <hr>
            <div class = "row">
              <div class = "col-md-4">
                <p class = "text-center">Press <strong>[R]</strong> for <i class="fa fa-hand-rock-o rps-ico" aria-hidden="true"></i></p>
              </div>
              <div class = "col-md-4">
                <p class = "text-center">Press <strong>[P]</strong> for <i class="fa fa-hand-paper-o rps-ico" aria-hidden="true"></i></p>
              </div>
              <div class = "col-md-4">
                <p class = "text-center">Press <strong>[S]</strong> for <i class="fa fa-hand-scissors-o rps-ico" aria-hidden="true"></i></p>
              </div>
            </div>
            <hr>
            <div class = "row">
              <div class = "col-md-6">
                <p>You Played: <span id="userInput"></span></p>
              </div>
              <div class = "col-md-6">
               <p>The Computer Played: <span id="computerInput"></span>
              </div></p>
            </div>
            <div class = "text-center"><span id="winner"></mark></div>        
            <hr>
            <div class = "row">
              <div class = "col-md-4">
                <span id = "wins" class = "h4"><p>Wins: </p></span>
              </div>
              <div class = "col-md-4">
                <span id = "losses" class = "h4"><p>Losses: </p></span>
              </div>
              <div class = "col-md-4">
                <span id = "draws" class = "h4"><p>Draws: </p></span>
              </div>
            </div>
            <hr>
            <span id = "matchesWon" class = "h3"><p>Matches Won: </p></span>
            <span id = "matchesLost" class = "h3"><p>Matches Lost: </p></span>

          </div>
        </div>
        <div class = "col-md-3 well">
          <div class = "h5"><u>Rules:</u></div>
          <ul>
            <li><i class="fa fa-hand-rock-o" aria-hidden="true"></i> beats <i class="fa fa-hand-scissors-o" aria-hidden="true"></i></li>
            <li><i class="fa fa-hand-paper-o" aria-hidden="true"></i> beats <i class="fa fa-hand-rock-o" aria-hidden="true"></i></li>
            <li><i class="fa fa-hand-scissors-o" aria-hidden="true"></i> beats <i class="fa fa-hand-paper-o" aria-hidden="true"></i></li>
            <li>First to 3, Wins Match</li>
            <li><mark>HAVE FUN!!!</mark></li>
          </ul>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      //set global variables
      var userTurn = document.getElementById("userInput");
      var userTurnIndex = 0;
      var computerTurnIndex = 0;
      var previousTurn = {
        indexes: 0,
        user: 0,
        winner: "none"
      };
      var turns = 0;
      var drawGame = false;
      var youWin = false;
      var wins = 0;
      var losses = 0;
      var draws = 0;
      var matchesWon = 0;
      var matchesLost = 0;
      var matchComplete = false;
      var validKeys = ["r", "p", "s"];
      var keyValues = ['<i class="fa fa-hand-rock-o" aria-hidden="true"></i>', '<i class="fa fa-hand-paper-o" aria-hidden="true"></i>', '<i class="fa fa-hand-scissors-o" aria-hidden="true"></i>'];
      var turnValue;
      var ids = ["userInput", "computerInput", "winner", "wins", "losses", "draws", "matchesWon", "matchesLost"];

      //check to see if user input meets the criteria
      var checkValid = function(key) {
        if (validKeys.includes(key)) {
          return true 
        } else {
        return false
        }
      }

      //calculate the move of the computer
      var computerTurn = function() {
        /*          this code makes the computer behave more humanly
        based on mathematical research: https://youtu.be/rudzYPHuewc
        the downside is that once the pattern is discerned the user
        can beat the computer every time, so I added a randomizer
        after a set number of turns                             */
        if (turns === 1 || previousTurn.winner === "draw" || turns % 6 === 0) {
        computerTurnIndex = Math.floor(Math.random() * 3);

          //play what wasn't played last time
        } else if (previousTurn.winner === "user") {

          //paper beat rock : 1 + 0
          if (previousTurn.indexes === 1) {
          computerTurnIndex = 2;

          //rock beat scissors: 0 + 2
          } else if (previousTurn.indexes === 2) {
            computerTurnIndex = 1;
          } else {
            computerTurnIndex = 0;
          }
        } else {

          //play what user played last time
            computerTurnIndex = previousTurn.user;
        }
      }

      //determine if user or computer wins the game
      var checkForGameWinner = function(val) {
        /*
        if userturn = computer then draw 
        if u = 0 and c = 1 computer win -1
        if u = 0 and c = 2 you win -2
        if u = 1 and c = 0 you win 1
        if u = 1 and c = 2 computer win -1
        if u = 2 and c = 0 computer win +2
        if u = 2 and c = 1 you win 1

        ----Look at patterns to reduce 7 conditionals to the following 3:
        if u - c = 0 draw
        if u - c = 1 or u - c = -2 you win
        else computer win
          */
        if (val === 0) {
          draws++;
          drawGame = true;
          previousTurn.winner = "draw";
        } else if (val === 1 || val === -2) {
          wins++;
          youWin = true;
          previousTurn.winner = "user";
          previousTurn.user = userTurnIndex;
        } else {
          losses++;
          youWin = false;
          previousTurn.winner = "computer";
        }
      }

      //determine if computer or user wins the match (first to 3 wins)
      var checkForMatchWinner = function() {
        if (wins === 3) {
          matchesWon++;
          wins = 0;
          losses = 0;
          draws = 0;
          matchComplete = true;
        } else if (losses === 3) {
        matchesLost++;
        losses = 0;
        wins = 0;
        draws = 0;
        matchComplete = true;
        }
      }

      //display values within html/css
      var displayResult = function() {
        var val = [];
        //remove old information
        for (var i = 0; i < ids.length; i++) {
          document.getElementById(ids[i]).innerHTML = "";
        }
        //create an array of new information
        val[0] = keyValues[userTurnIndex];
        val[1] = keyValues[computerTurnIndex];

        for (var b = 0; b < 2; b++) {
          document.getElementById(ids[b]).innerHTML = val[b];
        }

        if (drawGame) {
          val[2] = "draw";
          drawGame = false;
        } else if (youWin) {
          val[2] = "You Won!";
        } else {
          val[2] = "You Lose!";
        }
        val[3] = "Wins: " + wins;
        val[4] = "Losses: " + losses;
        val[5] = "Draws: " + draws;
        val[6] = "Matches Won: " + matchesWon;
        val[7] = "Matches Lost: " + matchesLost;

        //put new information into the html
        for (var c = 2; c < val.length; c++) {
          var para = document.createElement("P");
          var output = document.createTextNode(val[c]);
          para.appendChild(output);
          document.getElementById(ids[c]).appendChild(para);
        }
      }


      // function to execute on key press
      document.onkeyup = function () {
        userTurn.textContent = event.key;
        //console.log("userTurn.textContent: " + userTurn.textContent);

        if (checkValid(userTurn.textContent)) {
          turns++;
          computerTurn();
          userTurnIndex = validKeys.indexOf(userTurn.textContent);
          turnValue = userTurnIndex - computerTurnIndex;
          //console.log("turnValue :" + turnValue);
          checkForGameWinner(turnValue);
          checkForMatchWinner();
          displayResult();
          previousTurn.indexes = userTurnIndex + computerTurnIndex;
          /***needs work

          if (matchComplete) {
            var again = confirm("Do You Want to Play Again?");
          } 
          ****/
        } else {

          var para = document.createElement("P");
          var output = document.createTextNode("Invalid Input");
          para.appendChild(output);
          document.getElementById("winner").innerHTML = "";
          document.getElementById("winner").appendChild(para);
        }

      }
      
    </script>
  </body>
</html>
